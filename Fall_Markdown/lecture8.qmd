---
format: 
  revealjs:
    slide-number: true
    logo: images/image-393370223.png
    scrollable: true 
    theme: theme.scss
editor: visual
fontsize: 24pt
editor_options: 
  chunk_output_type: inline
---

</br></br>

<h1 style="text-align: center">

8 ç¦»æ•£å‹å˜é‡çš„çº¿æ€§å›å½’

</h1>

<h2 style="text-align: center">

</h2>

</br></br>

<h3 style="text-align: center">

Hu Chuan-Peng

</h3>

<h3 style="text-align: center">

2023-10-31

</h3>

</br></br>

# æœ¬æ¬¡è¯¾å†…å®¹

-   è¯¾å‰å¤ä¹ 

-   ç¦»æ•£å‹è‡ªå˜é‡çš„çº¿æ€§å›å½’

-   ç¦»æ•£å‹å› å˜é‡çš„çº¿æ€§å›å½’

# è¯¾å‰å¤ä¹ 

## å¤šå…ƒå›å½’è¡¨è¾¾å½¢å¼

-   å¤šå…ƒçº¿æ€§å›å½’ï¼ˆMultiple Linear Regressionï¼‰

$$Y = b_0 + b_{1}X_{1} + b_{2}X_{2} +... + b_{p}X_{p} + \epsilon$$

-   $Y$ -- å› å˜é‡ï¼ŒDependent variable

-   $X_i$ -- è‡ªå˜é‡ï¼ŒIndependent (explanatory) variable

-   $b_0$ -- æˆªè·ï¼ŒIntercept

-   $b_i$ -- æ–œç‡ï¼ŒSlope

-   $\epsilon$ -- æ®‹å·®ï¼ŒResidual (error)

## å¤šå…ƒå›å½’çŸ©é˜µè¡¨è¾¾

$$Y_{nÃ—1}=X_{nÃ—p}\beta_{pÃ—1}+\epsilon_{nÃ—1}$$

$$Y=X\beta+\epsilon$$

$$Y_i = b_0 +(\sum_{k=1}^{K}b_kX_{ik})+\epsilon_i$$

::: {layout-ncol="6"}
$$Y_{nÃ—1}=\begin{bmatrix}
  y_1 \\
  y_2 \\
  ... \\
  y_n
\end{bmatrix}$$

$$X_{nÃ—p}=\begin{bmatrix}
  1&x_{11}&x_{12}& &x_{1p} \\
  1&x_{21}&x_{12}& &x_{2p} \\
  ...&...&...&...  \\
  1&x_{n1}&x_{n2}& &x_{np}
\end{bmatrix}$$

$$\beta_{pÃ—1}=\begin{bmatrix}
 \beta_0\\
\beta_1\\
\beta_2\\
\ ...\\
\beta_p
\end{bmatrix}$$

$$\epsilon_{nÃ—1}=\begin{bmatrix}
 \epsilon_1\\
  \epsilon_2\\
  ...\\
  \epsilon_n\end{bmatrix}$$
:::

## å¤šå…ƒå›å½’ä»£ç è¡¨è¾¾(r)

</br>

Formula: $$Y \sim X_1 + X_2 + ... + X_n$$

</br>

$Y$ -- å› å˜é‡

$X_i$ -- è‡ªå˜é‡

## å¤šå…ƒå›å½’ä¸­çš„ç³»æ•°è§£è¯»

$$\hat{y_i}=b_0+b_1x_a+b_2x_b$$

-   $b_0$ : $x_a=0$ ä¸” $x_b=0$æ—¶ï¼Œå¯¹yçš„é¢„æµ‹å€¼

-   $b_1$ã€$b_2$: åå›å½’ç³»æ•°ï¼Œåæ˜ äº†å„è‡ªè‡ªå˜é‡å¯¹yçš„åæ•ˆåº”(partial effect)ï¼Œå³å•ç‹¬æ•ˆåº”

-   åæ•ˆåº”ï¼šå…¶ä»–è‡ªå˜é‡çš„å€¼ä¿æŒä¸å˜æ—¶ï¼ˆä¾‹å¦‚ï¼Œç­‰äº0ï¼‰ï¼Œå˜åŒ–æŸä¸ªè‡ªå˜é‡å¯¹å› å˜é‡äº§ç”Ÿçš„å½±å“

## å˜é‡é€‰æ‹©

åœ¨è§‚å¯Ÿç ”ç©¶ä¸­ï¼Œç”±äºæ‰€æœ‰å˜é‡éƒ½æ˜¯äº‹åè°ƒæŸ¥å¾—åˆ°çš„ï¼Œæˆ‘ä»¬åœ¨çœ‹å¾…å˜é‡ä¹‹é—´çš„å½±å“æ—¶ï¼Œå¯èƒ½ä¼šçŠ¯ä»¥ä¸‹é”™è¯¯ã€‚

-   æ··æ·†(confounding)ï¼šå„ç§è§£é‡Šå˜é‡ä¹‹é—´å­˜åœ¨ç›¸å…³å…³ç³»ï¼Œæ— æ³•ç¡®å®šå“ªä¸ªå˜é‡å¯¹ç»“æœäº§ç”Ÿäº†å½±å“ã€‚

-   è™šå‡å…³è”æ˜¯æ··æ·†çš„ç‰¹ä¾‹ï¼Œä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³è”æ˜¯ç”±äºç¬¬ä¸‰ä¸ªå˜é‡å¯¹ä¸¤ä¸ªå„è‡ªäº§ç”Ÿäº†å½±å“ã€‚

-   æ¡ä»¶ç‹¬ç«‹(conditionally independent)ï¼šç»™å®šç¬¬ä¸‰ä¸ªäº‹ä»¶ï¼Œå¦‚æœ$p(X,Y|Z) = p(X|Z)p(Y|Z)$ï¼Œåˆ™ç§°Xå’ŒYæ˜¯æ¡ä»¶ç‹¬ç«‹äº‹ä»¶,ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“Zå‘ç”Ÿæ—¶ï¼ŒXå‘ç”Ÿä¸å¦ä¸Yå‘ç”Ÿä¸å¦æ˜¯æ— å…³çš„ã€‚

-   å˜é‡ä¹‹é—´å­˜åœ¨å¼ºçƒˆçš„ç›¸å…³å…³ç³»ï¼Œæˆ‘ä»¬é”™è¯¯åœ°å°†ä¸åˆé€‚çš„å˜é‡çº³å…¥äº†å›å½’æ–¹ç¨‹ä¸­ï¼Œæœ‰å¯èƒ½å¾—å‡ºè’è°¬çš„ç»“è®ºã€‚å¦‚æœè¿™äº›å˜é‡è¢«åŒæ—¶çº³å…¥å›å½’æ–¹ç¨‹ï¼Œå°±è¡¨ç°ä¸ºå¤šé‡å…±çº¿æ€§ã€‚

## å¤šé‡å…±çº¿æ€§(multicollinearity)

-   $Y = b_0 + b_1X_1 + b_2X_2 + ... + b_pX_p + \epsilon$

-   å…¶åŸºæœ¬å‡è®¾ä¹‹ä¸€å°±æ˜¯è§£é‡Šå˜é‡é—´ç›¸äº’ç‹¬ç«‹ã€‚

-   å¦‚æœæŸä¸¤ä¸ªæˆ–å¤šä¸ªè§£é‡Šå˜é‡ä¹‹é—´å‡ºç°äº†ç›¸å…³æ€§ï¼Œåˆ™ç§°ä¸ºå¤šé‡å…±çº¿æ€§ã€‚

-   åœ¨è®¾è®¡çŸ©é˜µä¸­ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå˜é‡å¯ä»¥è¡¨ç¤ºä¸ºå…¶ä»–å˜é‡çš„çº¿æ€§ç»„åˆã€‚åˆ™å˜é‡ä¹‹é—´å­˜åœ¨å¤šé‡å…±çº¿æ€§ã€‚å³ï¼š$c_1x_1 + c_2x_2 + c_3x_3 + c_ix_i + \epsilon = 0$

-   è‹¥$\epsilon = 0$ï¼Œåˆ™ä¸ºå®Œå…¨å…±çº¿æ€§ï¼Œä½†åœ¨ç°å®æƒ…å†µå¹¶ä¸å¸¸è§ï¼Œä¸€èˆ¬$\epsilon \ne 0$ï¼Œå³è¿‘ä¼¼å…±çº¿æ€§ã€‚

## å¤šé‡å…±çº¿æ€§çš„è¯Šæ–­

-   å®¹è®¸åº¦(Tolerance) $TOL_{x_k} = 1 - R^2_{x_k}$

    -   å…¶ä¸­ï¼Œ $R^2_{x_k}$ä¸ºå¤ç›¸å…³ç³»æ•°ï¼Œä»¥$x_k$ä¸ºå› å˜é‡ï¼Œå…¶ä»–è‡ªå˜é‡æ¥é¢„æµ‹$x_k$çš„æ–°è‡ªå˜é‡è¿›è¡Œå›å½’ï¼Œæ‰€å¾—åˆ°çš„$R2$ã€‚ $R^2_{x_k}$è¶Šæ¥è¿‘1 è¯´æ˜$x_k$èƒ½è¢«å…¶ä»–è‡ªå˜é‡è§£é‡Šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ$1-R^2_{x_k}$è¶Šæ¥è¿‘0ï¼Œåˆ™å…±çº¿æ€§è¶Šä¸¥é‡ã€‚

-   æ–¹å·®è†¨èƒ€å› å­(variance inflation factor, VIF)

    -   å¯¹äºè‡ªå˜é‡$x_k$ï¼Œ$VIF_{x_k}=\frac{1}{TOL_{x_k}}=\frac{1}{1-R^2_{x_k}}$ï¼Œå½“å¤šé‡å…±çº¿æ€§ä¸¥é‡æ—¶ï¼Œ$R^2_{x_k}$è¶Šæ¥è¿‘äº1ï¼Œ$VIF_{x_k}$å˜å¤§ã€‚

## å¤šé‡å…±çº¿æ€§çš„å¤„ç†

1.  å¦‚æœå®Œå…¨å…±çº¿æ€§ï¼šç›´æ¥åˆ é™¤ä¸å¿…è¦çš„å˜é‡

2.  å¦‚æœæ˜¯è¿‘ä¼¼å…±çº¿æ€§ï¼Œå¤„ç†ä¾èµ–äºç»éªŒ

-   æ•´åˆè§£é‡Šå˜é‡ï¼ˆå¦‚é™ç»´çš„æ–¹æ³•------ä¸»æˆåˆ†åˆ†æç­‰ï¼‰

-   å¢åŠ æ ·æœ¬é‡

## æ ‡å‡†åŒ–å›å½’æ¨¡å‹

-   å›å½’æ¨¡å‹ä¸­æ¶‰åŠçš„è‡ªå˜é‡å…·æœ‰ä¸åŒçš„æµ‹é‡å•ä½ï¼Œå› æ­¤å›å½’ç³»æ•°ä¹‹é—´ä¸å…·æœ‰ç›´æ¥çš„å¯æ¯”æ€§ã€‚

-   é‡‡ç”¨æ ‡å‡†åŒ–å›å½’ç³»æ•°ï¼Œå°†è‡ªå˜é‡è½¬å˜ä¸ºæ— é‡çº²çš„å˜é‡ã€‚

## 

è®¾çœŸå®çš„å›å½’æ¨¡å‹ä¸ºï¼š

$$y_i = \beta_0+\beta_1x_{i1}+\beta_2x_{i2}+...+\beta_{p-1}x_{i(p-1)}+\epsilon_i$$

-   æ‰€æœ‰å˜é‡å‡å»å…¶å‡å€¼ï¼ˆæ”¹å˜åŸå§‹å˜é‡ä½ç½®ï¼Œè½¬æ¢åå˜é‡çš„å‡å€¼ä¸º0ï¼‰

-   å†é™¤ä»¥å…¶æ ‡å‡†å·®ï¼ˆæµ‹åº¦è½¬æ¢ï¼Œè½¬æ¢åå˜é‡çš„æ–¹å·®ä¸º1ï¼‰

-   å¾—åˆ°æ‰€æœ‰å˜é‡çš„æ ‡å‡†Zå€¼

æ ‡å‡†åŒ–çš„å›å½’æ¨¡å‹ï¼š

$$y_i = \beta_1^*x_{i1}+\beta_2^*x_{i2}+...+\beta_{p-1}^*x_{i(p-1)}+\epsilon_i$$

ï¼ˆå¸¸æ•°é¡¹ä¸º0ï¼Œæ²¡æœ‰æˆªè·é¡¹ï¼‰

## 

-   éæ ‡å‡†åŒ–ç³»æ•°ä¸æ ‡å‡†åŒ–ç³»æ•°çš„å…³ç³»

    -   æ ‡å‡†åŒ–ç³»æ•°ï¼š

        -   å›å½’å‚æ•°ä¼°è®¡å€¼å¤„äºï¼ˆ-1,1ï¼‰

        -   å¯åœ¨æ ‡å‡†åŒ–å°ºåº¦ä¸Šè¿›è¡Œæ¯”è¾ƒ

    -   éæ ‡å‡†åŒ–ç³»æ•°ï¼š

        -   æä¾›æ›´å¤šå…³äºæ•°æ®çš„ä¿¡æ¯

        -   æä¾›åŸºäºå®é™…å•ä½çš„è‡ªå˜é‡å¯¹å› å˜é‡çš„æ•ˆåº”

## å¤šå…ƒçº¿æ€§å›å½’çš„æ¨¡å‹é¢„è®¾(OLS)

  1.  æ•ˆåº¦ (Validity)

  2.  ç‹¬ç«‹æ€§é¢„è®¾ (Independence)

  3.  çº¿æ€§é¢„è®¾ (Linearity)

  4.  æ®‹å·®çš„æ–¹å·®é½æ€§ (åŒè´¨æ€§, homoscedasticity)

  5.  æ®‹å·®æ­£æ€æ€§(Normality)

  6.  å˜é‡é—´ä¸å­˜åœ¨å¤šé‡å…±çº¿æ€§

# ç¦»æ•£å‹è‡ªå˜é‡çš„çº¿æ€§å›å½’

## å¼•å…¥

-   æˆ‘ä»¬æƒ³æ¢ç©¶å®¶åº­æ”¶å…¥(HouseholdIncome)å’Œæ€§åˆ«(sex)ã€ç§æ—(race)å’Œç‘æ–‡æ¨ç†åˆ†æ•°(raven)çš„å…³ç³»ï¼›

-   é€‰å–[Eisenberg et al (2019)](https://www.nature.com/articles/s41467-019-10301-1)çš„æ•°æ®è¿›è¡Œåˆ†æã€‚

## 

-   ä¸€ä¸ªå…ˆå‰æ²¡æœ‰ç¢°åˆ°çš„é—®é¢˜ï¼š
    -   æ€§åˆ«æ˜¯äºŒåˆ†å˜é‡ï¼ˆç¦»æ•£çš„ï¼‰ï¼›
    -   ç§æ—æ˜¯ä¸€ä¸ªåˆ†ç±»å˜é‡ï¼ˆç§°åå˜é‡ï¼‰ï¼›
    -   å…·ä½“æ•°å€¼ç¼–ç å¹¶ä¸ä»£è¡¨çœŸå®çš„å·®å¼‚å¤§å°ã€‚
-   è‹¥æˆ‘ä»¬å°†ç§æ—ç¼–ç ç›´æ¥ä¸º1ã€2ã€3ã€4ã€5ï¼Œå¹¶ä¸”è¿›å…¥å›å½’æ–¹ç¨‹ï¼Œæš—å«ç€æŸäº›ç§æ—å¯¹æ”¶å…¥çš„å½±å“æ˜¯å¦ä¸€äº›ç§æ—çš„2å€ã€3å€......

## 

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸ç§æ—(3ä¸ªç§æ—)çš„å…³ç³»ï¼š $$Y = \beta_0 + \beta_1X + \epsilon$$
    -   åˆ™ç§æ—ä¸€çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0 + \beta_1$
    -   åˆ™ç§æ—äºŒçš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0 +2 \beta_1$
    -   åˆ™ç§æ—ä¸‰çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0 +3 \beta_1$

-   è¿™æ— ç–‘æ˜¯å¾ˆä¸ç¬¦åˆå®é™…çš„ã€‚

## 

é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†åˆ†ç±»å˜é‡å‘¢ï¼Ÿ

## è™šæ‹Ÿå˜é‡(dummy coding)

-   è™šæ‹Ÿå˜é‡(æˆ–å“‘å˜é‡)æ˜¯ä¸€ç§å¯¹ç§°åï¼ˆæˆ–åä¹‰ï¼‰å˜é‡çš„åˆ†ç±»é‡æ–°ç¼–ç ï¼Œä½¿å¾—å®ƒä»¬èƒ½åœ¨å›å½’æ–¹ç¨‹ä¸­ä½œä¸ºè‡ªå˜é‡çš„æ–¹å¼ã€‚

-   å®ƒå°†æŸä¸€åˆå§‹ç§°åå˜é‡é‡æ–°å»ºæ„å¾—åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªäºŒåˆ†å˜é‡ã€‚

-   ä¸€èˆ¬æ¥è¯´ï¼Œå½“æŸä¸ªæ ·æœ¬è§‚æµ‹å€¼å±äºåä¹‰å˜é‡çš„æŸä¸ªç±»åˆ«æ—¶ï¼Œè¡¨å¾è¿™ä¸ªç±»åˆ«çš„è™šæ‹Ÿå˜é‡å°±è¢«èµ‹å€¼ä¸º1ï¼Œå¦åˆ™ä¾¿è¢«èµ‹å€¼ä¸º0ã€‚

## 

-   åœ¨æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œè‹¥æƒ³è¦å¯¹æ€§åˆ«è¿›è¡Œç¼–ç ï¼Œåˆ™å¯èƒ½çš„æ–¹å¼æ˜¯ï¼š

    -   X = 1 : å¥³æ€§
    -   X = 0 : ç”·æ€§ï¼ˆéå¥³æ€§ï¼‰

## 

å‡å¦‚æˆ‘ä»¬ä»…å…³æ³¨å®¶åº­æ”¶å…¥ä¸æ€§åˆ«(ç”·/å¥³)çš„å…³ç³», åˆ™æœ‰å¦‚ä¸‹å›å½’æ¨¡å‹

$$Y = \beta_0 + \beta_1 X+ \epsilon$$

-   åˆ™ç”·æ€§çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0$

-   åˆ™å¥³æ€§çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0 + \beta_1$

-   å½“è™šæ‹Ÿå˜é‡èµ‹å€¼ä¸º0æ—¶ï¼Œ

    -   $\beta_0$ ä»£è¡¨ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ï¼›
    -   $\beta_0 + \beta_1$ ä»£è¡¨å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ï¼›
    -   $\beta_1$ è¡¨ç¤ºå¥³æ€§ç›¸å¯¹äºç”·æ€§çš„å®¶åº­æ”¶å…¥çš„å·®å€¼ã€‚

## è®¾è®¡çŸ©é˜µ

-   æˆ‘ä»¬å¯ä»¥ç”¨çŸ©é˜µçš„å½¢å¼æ¥è¿›è¡Œè¡¨è¾¾ï¼š

$$Y = \beta_0 + \beta_1 X+\epsilon$$

::: {layout-ncol="6"}
$$X_{nÃ—p}=\begin{bmatrix}
  1&1 \\
  1&1\\
  1&0\\
  ...&...\\
  1&0
\end{bmatrix}$$

$$\beta_{pÃ—1}=\begin{bmatrix}
 \beta_0\\
\beta_1\\
\end{bmatrix}$$

$$Y_{nÃ—1}=\begin{bmatrix}
  y_1 \\
  y_2 \\
  y_3 \\
  ... \\
  y_n
\end{bmatrix}=\begin{bmatrix}
  \beta_0+\beta_1+\epsilon \\
  \beta_0+\beta_1+\epsilon \\
  \beta_0+\epsilon\\
  ... \\
  \beta_0+\epsilon
\end{bmatrix}$$
:::

## åœ¨Rä¸­çš„æ“ä½œ

```{r}
# load packages
library(pacman)
p_load('tidyverse','bruceR',"apaTables","ggplot2","papaja")
```

**Step 1**: è™šæ‹Ÿå˜é‡ç¼–ç ï¼Œç”·=0ï¼Œå¥³=1
```{r echo=TRUE}
# load files
df <- read.csv("data/example8.1.csv") %>%
      mutate(Sex = factor(Sex))

df_1 <- df %>% 
      dplyr::select(X, Sex, HouseholdIncome)

head(df_1)

contrasts(df_1$Sex)
```
##

**Step 2**: å»ºç«‹å›å½’æ¨¡å‹

```{r echo=TRUE}
Model = lm(data = df, HouseholdIncome ~ Sex)

summary(Model)
```

##

**Step 3**: æ¨¡å‹æ•´ä½“æ£€éªŒ

```{r echo=TRUE}
Model = lm(data = df, HouseholdIncome ~ Sex)

summary(Model)
```
Multiple R-squared:  0.006947,	Adjusted R-squared:  0.005037,  p-value: 0.05704

## 

**Step 4**: åå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

```{r echo=TRUE}
Model = lm(data = df, HouseholdIncome~Sex)
temp<-summary(Model)
temp[["coefficients"]]
```

$$\begin{bmatrix}
 \beta_0\\
\beta_1\\
\end{bmatrix}=\begin{bmatrix}
 45471.888\\
5204.669\\
\end{bmatrix}$$

## å›å½’ç³»æ•°çš„è§£é‡Š

-   æŒ‰ä¹‹å‰çš„çº¿æ€§å›å½’çš„è§£é‡Šï¼š 
    -   $\beta_0$: å›å½’æ–¹ç¨‹æˆªè·
    
    -   $\beta_1$: è™šæ‹Ÿå˜é‡sexçš„å›å½’ç³»æ•°

-   é‡‡ç”¨Dummy codingä¹‹åçš„è§£é‡Šï¼š 
    -   $\beta_0$: æ ·æœ¬ä¸­ç”·æ€§ç¾¤ä½“æ”¶å…¥çš„å‡å€¼
    
    -   $\beta_0+\beta_1$: æ ·æœ¬ä¸­å¥³æ€§ç¾¤ä½“æ”¶å…¥çš„å‡å€¼ 
    
    -   $\beta_1$: å¥³æ€§ä¸ç”·æ€§ç¾¤ä½“æ”¶å…¥çš„å·®å€¼

## å•å˜é‡ä¸‰æ°´å¹³çš„è™šæ‹Ÿå˜é‡ç¼–ç 

</br>

å½“åˆ†ç±»å˜é‡å¤šäº2ä¸ªæ°´å¹³æ—¶ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆç”¨è™šæ‹Ÿå˜é‡æ¥è¿›è¡Œè¡¨ç¤ºå‘¢ï¼Ÿ

## 

-   ä¸€èˆ¬æ¥è¯´ï¼Œå¯¹äºåŒ…æ‹¬kä¸ªç±»åˆ«çš„åä¹‰å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨*k-1ä¸ªè™šæ‹Ÿå˜é‡*æ¥è¿›è¡Œç¼–ç ã€‚

-   è‹¥æˆ‘ä»¬ä½¿ç”¨kä¸ªè™šæ‹Ÿå˜é‡è¿›è¡Œç¼–ç ï¼Œåˆ™ä¼šå‡ºç°å¤šé‡å…±çº¿æ€§çš„é—®é¢˜ï¼Œå³å…¶ä¸­ä¸€ä¸ªå˜é‡å¯ä»¥è¡¨ç¤ºä¸ºå…¶ä»–å˜é‡çš„çº¿æ€§ç»„åˆã€‚

## 

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸ç§æ—(äºšè£” /éè£”/æ¬§è£”)çš„å…³ç³»ï¼š
    -   æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªè™šæ‹Ÿå˜é‡æ¥å¯¹å˜é‡è¿›è¡Œè¡¨ç¤º $$Y = \beta_0 + \beta_1X_1 + \beta_2X2 + \epsilon$$

        |      |     |     |
        |------|-----|-----|
        |      | X1  | X2  |
        | äºšè£” | 0   | 0   |
        | éè£” | 1   | 0   |
        | æ¬§è£” | 0   | 1   |

    -   äºšè£”è¡¨ç¤ºä¸ºx1=0ï¼Œx2=0

    -   éè£”è¡¨ç¤ºä¸ºx1=1ï¼Œx2=0

    -   æ¬§è£”è¡¨ç¤ºä¸ºx1=0ï¼Œx2=1

## 

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸ç§æ—(äºšè£” /éè£”/æ¬§è£”)çš„å…³ç³»ï¼š
    -   æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªè™šæ‹Ÿå˜é‡æ¥å¯¹å˜é‡è¿›è¡Œè¡¨ç¤º $$Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + \epsilon$$

        |      |     |     |
        |------|-----|-----|
        |      | X1  | X2  |
        | äºšè£” | 0   | 0   |
        | éè£” | 1   | 0   |
        | æ¬§è£” | 0   | 1   |

    -   åˆ™äºšè£”çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0$

    -   åˆ™éè£”çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0+\beta_1$

    -   åˆ™æ¬§è£”çš„é¢„æµ‹å€¼ä¸º $E(Y) = \beta_0+\beta_2$

## 

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸ç§æ—(äºšè£” /éè£”/æ¬§è£”)çš„å…³ç³»ï¼š
    -   æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ä¸ªè™šæ‹Ÿå˜é‡æ¥å¯¹å˜é‡è¿›è¡Œè¡¨ç¤º $$Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + \epsilon$$

        |      |     |     |
        |------|-----|-----|
        |      | X1  | X2  |
        | äºšè£” | 0   | 0   |
        | éè£” | 1   | 0   |
        | æ¬§è£” | 0   | 1   |

    -   $\beta_0$è¡¨ç¤ºäºšè£”çš„å¹³å‡å®¶åº­æ”¶å…¥

    -   $\beta_1$è¡¨ç¤ºéè£”ç›¸å¯¹äºäºšè£”çš„å¹³å‡å®¶åº­æ”¶å…¥çš„å·®å€¼

    -   $\beta_2$è¡¨ç¤ºæ¬§è£”ç›¸å¯¹äºäºšè£”çš„å¹³å‡å®¶åº­æ”¶å…¥çš„å·®å€¼

## è®¾è®¡çŸ©é˜µ

æˆ‘ä»¬å¯ä»¥ç”¨çŸ©é˜µçš„å½¢å¼æ¥è¿›è¡Œè¡¨è¾¾ï¼š $$Y=\beta_0+\beta_1X_1+\beta_2X_2+\epsilon$$

::: {layout-ncol="6"}
$$X_{nÃ—p}=\begin{bmatrix}
  1&0&0 \\
  1&1&0\\
  1&0&1\\
\end{bmatrix}$$

$$\beta_{pÃ—1}=\begin{bmatrix}
 \beta_0\\
\beta_1\\
\beta_2
\end{bmatrix}$$

$$Y_{nÃ—1}=\begin{bmatrix}
  y_1 \\
  y_2 \\
  y_3 
\end{bmatrix}=\begin{bmatrix}
  \beta_0+\epsilon\\
  \beta_0+\beta_1+\epsilon \\
  \beta_0+\beta_2+\epsilon\\
\end{bmatrix}$$
:::

## åœ¨Rä¸­çš„æ“ä½œ

**Step 1**: è™šæ‹Ÿå˜é‡ç¼–ç ï¼Œäºšè£”ä¸ºåŸºçº¿

```{r echo=TRUE}
df <-df %>%
  mutate(race = case_when(Race %in% c("White"," American Indian or Alaska Native" ,
                                      " Native Hawaiian or Other Pacific Islander",
                                      "Other","Choose not to respond" ) ~ "æ¬§è£”",
                          Race %in% c("Japanese", "Chinese"," Asian Indian",
                                      " Vietnamese","Korean"," Filipino",
                                      " Middle Eastern or North African",
                                      " Other Asian") ~ "äºšè£”",
                          Race %in% c(" Black or African American") ~ "éè£”"),
         race = factor(race),
         race = relevel(race, ref = "äºšè£”")) # è®¾ç½®åŸºçº¿
contrasts(df$race)
```

## 

**Step 2**: è¿›è¡Œçº¿æ€§å›å½’

```{r echo=TRUE}
Model_2 = lm(data = df, HouseholdIncome ~ race)

summary(Model_2)

```

## 

**Step 3**: æ¨¡å‹æ•´ä½“æ£€éªŒ

```{r echo=TRUE}
Model_2 = lm(data = df, HouseholdIncome ~ race)

summary(Model_2)
```
Multiple R-squared:  0.000253,	Adjusted R-squared:  -0.0036 , *p*-value: 0.9365

## 

**Step 4**: åå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

```{r echo=TRUE}
Model_2 = lm(data = df, HouseholdIncome~race)
summary(Model_2)$coef
```

$$\begin{bmatrix}
 \beta_0\\
\beta_1\\
\beta_2\\
\end{bmatrix}=\begin{bmatrix}
 49905 \\
-1926\\
-2297 \\
\end{bmatrix}$$


## ä¸¤ä¸ªåˆ†ç±»å˜é‡çš„è™šæ‹Ÿå˜é‡ç¼–ç 

-   è‹¥ä¸¤ä¸ªåˆ†ç±»å˜é‡(æ€§åˆ«/ç§æ—)åŒæ—¶å­˜åœ¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

## 

-   è‹¥ä¸¤ä¸ªåˆ†ç±»å˜é‡(æ€§åˆ«/ç§æ—)åŒæ—¶å­˜åœ¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

-   æœ€ç†æƒ³çš„æƒ…å†µï¼Œå˜é‡ä¹‹é—´ä¸å­˜åœ¨äº¤äº’ä½œç”¨ã€‚

## ä¸¤ä¸ªåˆ†ç±»å˜é‡é—´ä¸å­˜åœ¨äº¤äº’ä½œç”¨

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸æ€§åˆ«å’Œç§æ—(äºšè£” /éè£”/æ¬§è£”)çš„å…³ç³»ï¼š

$$Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + \beta_3X_3 + \epsilon$$

|      |     |
|------|-----|
|      | X1  |
| ç”·æ€§ | 0   |
| å¥³æ€§ | 1   |

|      |     |     |
|------|-----|-----|
|      | X2  | X3  |
| äºšè£” | 0   | 0   |
| éè£” | 1   | 0   |
| æ¬§è£” | 0   | 1   |

## 

-   äºšè£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0$

-   äºšè£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1$

-   éè£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_2$

-   éè£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1 + \beta_2$

-   æ¬§è£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_3$

-   æ¬§è£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1 + \beta_3$

## åœ¨Rä¸­çš„æ“ä½œ

**Step 1**:è™šæ‹Ÿå˜é‡ç¼–ç 
```{r echo=TRUE}
contrasts(df$Sex)
contrasts(df$race)
```

## 

**Step 2**:è¿›è¡Œçº¿æ€§å›å½’

```{r echo=TRUE}
model_3 <- lm(HouseholdIncome ~ Sex + race, data = df)
summary(model_3)
```

##

æ¨¡å‹æ•´ä½“æ£€éªŒ

```{r echo=TRUE}
summary(model_3)
```
Multiple R-squared:  0.007035,	Adjusted R-squared:  0.001285 , p-value: 0.3005

## 

åå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

```{r echo=TRUE}
summary(model_3)$coef
```
$$\begin{bmatrix}
 \beta_0\\
\beta_1\\
\beta_2\\
\beta_3\\
\end{bmatrix}=\begin{bmatrix}
 45535.4417 \\
5188.0890\\
1018.0644 \\
-144.5501 \\
\end{bmatrix}$$


## å›å½’ç³»æ•°çš„è§£é‡Š

:::{style="font-size:24px"}
-   $HouseholdIncome =45535.4+5188.1sex+1018.1race_{black}-144.6race_{white}$
-   ä¸‰ä¸ªè™šæ‹Ÿå˜é‡åˆ’åˆ†çš„6ç»„äººç¾¤å¯¹åº”çš„å›å½’æ¨¡å‹çš„ä¼°è®¡ç»“æœ
    -   (1)äºšè£”çš„ç”·æ€§ï¼ˆsex =0ï¼Œrace_black = 0ï¼Œ race_white=0ï¼Œå‚ç…§ç»„ï¼‰
        -   $HouseholdIncome =45535.4$
    -   (2)äºšè£”çš„å¥³æ€§ï¼ˆsex =1ï¼Œrace_black = 0ï¼Œ race_white=0ï¼‰
        -   $HouseholdIncome =45535.4+5188.1$
    -   (3)æ¬§è£”çš„ç”·æ€§ï¼ˆsex =0ï¼Œrace_black = 0ï¼Œ race_white=1ï¼‰
        -   $HouseholdIncome =45535.4 -144.6$
    -   (4)æ¬§è£”çš„å¥³æ€§ï¼ˆsex =1ï¼Œrace_black = 0ï¼Œ race_white=1ï¼‰
        -   $HouseholdIncome =45535.4+5188.1-144.6$
    -   (5)éè£”çš„å¥³æ€§ï¼ˆsex =1ï¼Œrace_black = 1ï¼Œ race_white=0ï¼‰
        -   $HouseholdIncome =45535.4+5188.1+1018.1$
    -   (6)éè£”çš„ç”·æ€§ï¼ˆsex =0ï¼Œrace_black = 1ï¼Œ race_white=1ï¼‰
        -   $HouseholdIncome =45535.4+1018.1$
-   æ–¹ç¨‹é—´æˆªè·å·®å€¼ç”±$\beta_1$, $\beta_2$å’Œ$\beta_3$å†³å®š

:::


## 

-   è‹¥ä¸¤ä¸ªåˆ†ç±»å˜é‡(æ€§åˆ«/ç§æ—)åŒæ—¶å­˜åœ¨ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

-   æœ€ç†æƒ³çš„æƒ…å†µï¼Œå˜é‡ä¹‹é—´ä¸å­˜åœ¨äº¤äº’ä½œç”¨ã€‚

-   ä½†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå˜é‡ä¹‹é—´å­˜åœ¨äº¤äº’ä½œç”¨ã€‚

## ä¸¤ä¸ªå˜é‡é—´å­˜åœ¨äº¤äº’ä½œç”¨

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸æ€§åˆ«å’Œç§æ—(äºšè£”/éè£”/æ¬§è£”)çš„å…³ç³»ï¼Œä¸”æ€§åˆ«å’Œç§æ—é—´å­˜åœ¨äº¤äº’ä½œç”¨ï¼š

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_3 + \beta_4 X_1 X_2 + \beta_5 X_1 X_3 + \epsilon$$

|      |     |
|------|-----|
|      | X1  |
| ç”·æ€§ | 0   |
| å¥³æ€§ | 1   |

|      |     |     |
|------|-----|-----|
|      | X2  | X3  |
| äºšè£” | 0   | 0   |
| éè£” | 1   | 0   |
| æ¬§è£” | 0   | 1   |

## 

-   äºšè£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0$
-   äºšè£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1$
-   éè£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_2$
-   éè£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1 + \beta_2+ \beta_4$
-   æ¬§è£”ç”·æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_3$
-   æ¬§è£”å¥³æ€§çš„å¹³å‡å®¶åº­æ”¶å…¥ $E(Y) = \beta_0 + \beta_1 + \beta_3 + \beta_5$


## åœ¨Rä¸­çš„æ“ä½œ

**Step 1**:è™šæ‹Ÿå˜é‡ç¼–ç 

```{r echo=TRUE}
contrasts(df$Sex)
contrasts(df$race)
```

##

**Step 2**:è¿›è¡Œçº¿æ€§å›å½’
```{r echo=TRUE}
model_4 <- lm(HouseholdIncome ~ Sex * race, data = df)
summary(model_4)
```

##

æ¨¡å‹æ•´ä½“æ£€éªŒ
```{r echo=TRUE}
summary(model_4)
```
Multiple R-squared:  0.0104,	Adjusted R-squared:  0.0008107 , p-value: 0.3679

## 

åå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

```{r echo=TRUE}
summary(model_4)$coef
```

$$\begin{bmatrix}
 \beta_0\\
\beta_1\\
\beta_2\\
\beta_3\\
\beta_4\\
\beta_5\\
\end{bmatrix}=\begin{bmatrix}
45255.8235  \\
5764.8015\\
8737.1765 \\
-368.3610 \\
-13967.8015 \\
 432.3731 \\
\end{bmatrix}$$

## è‡ªå˜é‡åŒæ—¶åŒ…æ‹¬åˆ†ç±»å˜é‡å’Œè¿ç»­å˜é‡

-   å¯¹äºåˆ†ç±»å˜é‡ä¸è¿ç»­å˜é‡åŒæ—¶å­˜åœ¨ï¼Ÿ

-   å‡å®šå˜é‡ä¹‹é—´ä¸å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œæ¯”è¾ƒå®¹æ˜“å¤„ç†ã€‚

## å˜é‡é—´ä¸å­˜åœ¨äº¤äº’ä½œç”¨

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬å…³æ³¨å®¶åº­æ”¶å…¥ä¸æ€§åˆ«å’Œç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon$$

-   ç”·æ€§çš„å®¶åº­æ”¶å…¥($X_1=0$)ä¸ç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š
    -   $Y_{male} = \beta_0+\beta_2 X_2+\epsilon$
-   å¥³æ€§çš„å®¶åº­æ”¶å…¥($X_1= 1$)ä¸ç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š
    -   $Y_{female} = \beta_0 + \beta_1+\beta_2 X_2+\epsilon$

-   æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚æœä¸å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œæ€§åˆ«å¯¹å®¶åº­æ”¶å…¥çš„å½±å“ä¸»è¦ä½“ç°åœ¨æˆªè·ä¸Šã€‚

## åœ¨Rä¸­çš„æ“ä½œ

```{r echo=TRUE}
model_5 <- lm(HouseholdIncome ~ Sex + ravens.score, data = df)

summary(model_5)
```

## å˜é‡é—´å­˜åœ¨äº¤äº’ä½œç”¨

-   å¦‚æœåˆ†ç±»å˜é‡ä¸è¿ç»­å˜é‡åŒæ—¶å­˜åœ¨ä¸”å¯èƒ½æœ‰äº¤äº’ä½œç”¨å‘¢ï¼Ÿ

## 

-   ä¾‹å¦‚ï¼Œæˆ‘ä»¬åªå…³æ³¨å®¶åº­æ”¶å…¥ä¸æ€§åˆ«å’Œç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š

$$Y =\beta_0+\beta_1 X_1+\beta_2 X_2+\beta_3 X_1 X_2+\epsilon$$

-   ç”·æ€§çš„å®¶åº­æ”¶å…¥ï¼ˆ$X_1$ = 0ï¼‰ä¸ç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š
    -   $Y_{male} = \beta_0 + \beta_2 X_2 + \epsilon$
-   å¥³æ€§çš„å®¶åº­æ”¶å…¥ï¼ˆ$X_1$ = 1ï¼‰ä¸ç‘æ–‡æ¨ç†åˆ†æ•°çš„å…³ç³»ï¼š
    -   $Y_{female} = \beta_0 + \beta_1 + \beta_2 X_2 + \beta_3 X_2 + \epsilon = \beta_0 + \beta_1 + (\beta_2 + \beta_3)X_2 + \epsilon$

-   æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè‹¥å­˜åœ¨äº¤äº’é¡¹ï¼Œäº¤äº’é¡¹çš„å¯¹å˜é‡çš„å½±å“ä¼šä½“ç°åœ¨æ–œç‡ä¸Šã€‚

## 

-   åœ¨å›å½’æ¨¡å‹ä¸­ï¼Œå¦‚æœæ¯ä¸ªè‡ªå˜é‡å¯¹å› å˜é‡çš„ä½œç”¨ä¸å—å…¶ä»–è‡ªå˜é‡å–å€¼çš„å½±å“ï¼Œå³åªå­˜åœ¨ä¸»æ•ˆåº”(main effect)ã€‚è‹¥æŸä¸ªè‡ªå˜é‡å¯¹å› å˜é‡çš„ä½œç”¨ä¼šä¾èµ–äºå…¶ä»–è‡ªå˜é‡çš„å–å€¼ï¼Œå³å­˜åœ¨æ¡ä»¶æ•ˆåº”(conditional effect)ã€‚

-   äº¤äº’é¡¹è¡¨ç¤ºçš„å°±æ˜¯æ¡ä»¶æ•ˆåº”çš„å½±å“ã€‚æ¨¡å‹å­˜åœ¨äº¤äº’é¡¹æ—¶ï¼Œå„è‡ªå˜é‡å¯¹å› å˜é‡çš„ä½œç”¨ä¾èµ–äºäº¤äº’é¡¹ä¸­å…¶ä»–è‡ªå˜é‡çš„å–å€¼ã€‚


[å·®ä¹‹æ¯«å˜ï¼Œè°¬ä»¥åƒé‡Œï¼šè¾¨æã€Œå›ºå®šæ•ˆåº”ã€ä¸»æ•ˆåº”ã€ç®€å•æ•ˆåº”ã€](https://zhuanlan.zhihu.com/p/513227882)

## 

-   æˆ‘ä»¬å¯ä»¥é€šè¿‡å¯¹å˜é‡æ±‚å¯¼æ¥çœ‹è¯¥å˜é‡çš„å˜åŒ–å—é‚£äº›å› ç´ çš„å½±å“ã€‚

-   è‹¥ä¸å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œæˆ‘ä»¬å¯¹è¿ç»­å˜é‡$X_2$æ±‚åå¯¼ï¼š

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \epsilon$$

$$\frac{ğœ•Y}{ğœ•X}=\beta_2$$

-   è‹¥ä¸å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œè¿ç»­å˜é‡$X_2$ä¸å—å¦ä¸€ä¸ªå˜é‡çš„å½±å“ã€‚

## 

-   è‹¥å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œæˆ‘ä»¬å¯¹è¿ç»­å˜é‡$X_2$æ±‚åå¯¼ï¼š

$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \beta_3 X_1 X_2 + \epsilon$$

$$\frac{ğœ•Y}{ğœ•X} = \beta_2  + \beta_3 X_1$$

-   è‹¥å­˜åœ¨äº¤äº’ä½œç”¨ï¼Œè¿ç»­å˜é‡$X_2$çš„æ•ˆåº”å—å¦ä¸€ä¸ªå˜é‡çš„å½±å“ã€‚

## åœ¨Rä¸­çš„æ“ä½œ

```{r echo=TRUE}
model_6 <- lm(HouseholdIncome ~ Sex + ravens.score + Sex:ravens.score, data=df)

summary(model_6)
```

## å°ç»“ 

-   è‡ªå˜é‡æ˜¯ç¦»æ•£å˜é‡æ—¶ï¼Œå¯é€šè¿‡æ„é€ è™šæ‹Ÿå˜é‡è¿›è¡Œå›å½’
    -   è™šæ‹Ÿå˜é‡çš„æ•°é‡ï¼šk-1 ï¼Œkä¸ºç¦»æ•£è‡ªå˜é‡çš„æ°´å¹³æ•°ï¼›
-   å­˜åœ¨å¤šä¸ªè‡ªå˜é‡æ—¶ï¼Œå›å½’æ¨¡å‹ä¸­éœ€è¦è€ƒè™‘äº¤äº’é¡¹
    -   äº¤äº’é¡¹å¯¹å›å½’ç³»æ•°ï¼ˆæ–œç‡, slopeï¼‰äº§ç”Ÿå½±å“

## Dummy codingä»¥å¤–çš„ç¼–ç æ–¹å¼

-   Dummy codingï¼Œä¹Ÿå«treatment coding

-   ä¸å«æˆªè·é¡¹çš„ç¼–ç 

-   æ•ˆåº”ç¼–ç (effect coding)

-   æ­£äº¤ç¼–ç (orthogonal coding)

# ç¦»æ•£å‹å› å˜é‡çš„çº¿æ€§å›å½’

## 

-   å¦‚æœå› å˜é‡ä¸ºåˆ†ç±»å˜é‡ï¼Œæˆ‘ä»¬è¯¥å¦‚ä½•å¤„ç†ï¼Ÿ

-   ä¾‹å¦‚ï¼Œä¸ªä½“çš„self-regulationèƒ½å¦é¢„æµ‹ä¸ªä½“çš„é…—é…’è¡Œä¸ºã€‚

-   å› å˜é‡ï¼šæ˜¯å¦é…—é…’ï¼ˆ0 or 1ï¼‰

-   å¦‚ä½•å»ºç«‹å›å½’æ¨¡å‹ï¼Ÿ

## çº¿æ€§æ¨¡å‹çš„ç»„æˆéƒ¨åˆ†

![](images/1698463307289.png)

## 

![](images/1698463376812.png)

## å›å½’æ–¹ç¨‹çš„å¤šç§è¡¨è¾¾å½¢å¼

-   æˆ‘ä»¬ä¹‹å‰æåˆ°ï¼Œå›å½’æ–¹ç¨‹æœ‰å¤šç§è¡¨è¾¾å½¢å¼ï¼š

-   ç®€å•çº¿æ€§å›å½’ï¼š$Y = b_0+ğ‘_1 X_1+ ğ‘_2 X_2+â€¦+ğ‘_ğ‘ X_ğ‘ + Ïµ$

-   çº¿æ€§ä»£æ•°è¡¨è¾¾ï¼š$y_i = b_0 + b_1 X_{i1} + b_2 X_{i2} + â€¦ + b_p X_{ip} + \epsilon$

-   çŸ©é˜µè¡¨è¾¾: $Y= X\beta + \epsilon$

-   ä»£ç è¡¨è¾¾(r): $Y \sim X_1 + X_2 + ... + X_n$

## å›å½’æ–¹ç¨‹çš„æ¦‚ç‡åˆ†å¸ƒè¡¨è¾¾

æˆ‘ä»¬è¿˜å¯ä»¥ç”¨æ¦‚ç‡åˆ†å¸ƒçš„å½¢å¼è¿›è¡Œè¡¨è¾¾ï¼š

-   è§‚æµ‹é¡¹ = é¢„æµ‹é¡¹ + è¯¯å·®é¡¹

-   å‡å®šè§‚æµ‹é¡¹æ˜¯æ­£æ€åˆ†å¸ƒï¼Œä¸Šè¿°å…¬å¼å¯ä»¥é‡æ–°è¡¨è¾¾ä¸ºï¼š

    -   è§‚æµ‹é¡¹ï¼š$y \sim N(\mu, \epsilon)$
    -   å…¶ä¸­ï¼Œ $\mu$å³ä¸ºé¢„æµ‹é¡¹ï¼Œ$\mu = \beta_0 + \beta_1 x$

-   è§‚æµ‹å€¼æœä»ä»¥é¢„æµ‹é¡¹ä¸ºå‡å€¼çš„æ­£æ€åˆ†å¸ƒï¼Œè§‚æµ‹å€¼ä¸é¢„æµ‹å€¼ä¹‹é—´çš„å·®å€¼å°±æ˜¯æ®‹å·®ã€‚

## 

è§‚æµ‹é¡¹ï¼š$y \sim N(\mu, \epsilon)$

é¢„æµ‹é¡¹ï¼š$\mu = \beta_0 + \beta_1 x$

-   å¦‚æœå› å˜é‡ä¸æ˜¯è¿ç»­å˜é‡ï¼Œé¢„æµ‹å˜é‡ä¸æœä»æ­£æ€åˆ†å¸ƒï¼Œå³$y \sim N(\mu, \epsilon)$ä¸æˆç«‹ã€‚

## 

![](images/1698464084969.png)

## 

![](images/1698464160346.png)

## å¹¿ä¹‰çº¿æ€§æ¨¡å‹(Generalized Linear Model, GLM)

-   åœ¨ç®€å•çº¿æ€§å›å½’ä¸­ï¼Œé¢„æµ‹é¡¹çš„è¿æ¥å‡½æ•°ç­‰äºå®ƒæœ¬èº«

![](images/1698464237129.png)

## 

-   ç®€å•çº¿æ€§æ¨¡å‹å¯è§†ä¸ºGLMçš„ç‰¹æ®Šå½¢å¼ï¼Œé¢„æµ‹é¡¹çš„è¿æ¥å‡½æ•°ç­‰äºå®ƒæœ¬èº«ï¼Œè§‚æµ‹é¡¹ä¸ºæ­£æ€åˆ†å¸ƒã€‚

-   åœ¨å¹¿ä¹‰çº¿æ€§æ¨¡å‹ä¸­ï¼š

    -   è§‚æµ‹é¡¹ä¸ä¸€å®šæ˜¯æ­£æ€åˆ†å¸ƒï¼ˆæ®‹å·®ä¸ä¸€å®šæ˜¯æ­£æ€åˆ†å¸ƒï¼‰
    -   è¿æ¥å‡½æ•°ä¸ç­‰äºå…¶è‡ªèº«

-   é€šè¿‡å¹¿ä¹‰çº¿æ€§æ¨¡å‹ï¼Œèƒ½å¤Ÿå¯¹ç¦»æ•£çš„å› å˜é‡è¿›è¡Œå»ºæ¨¡

## å¹¿ä¹‰çº¿æ€§æ¨¡å‹(GLM)çš„åŸºæœ¬æˆåˆ†

![](images/1698464321763.png)

## 

-   å›åˆ°ä¾‹å­ï¼šä¸ªä½“çš„self-regulationå¾—åˆ†èƒ½å¦é¢„æµ‹å…¶é…—é…’è¡Œä¸ºï¼Ÿ

-   é—®é¢˜æƒ…å¢ƒï¼š

    -   è‡ªå˜é‡ï¼ˆé¢„æµ‹é¡¹ï¼‰ï¼šé—®å·å¾—åˆ†ï¼Œè¿ç»­å˜é‡
    -   å› å˜é‡ï¼šæ˜¯å¦é…—é…’ï¼ŒäºŒåˆ†å˜é‡

## 

-   é¢„æµ‹é¡¹å¯è¡¨ç¤ºä¸ºï¼š $z = \beta_0 + \beta_1 ğ‘¥$, å…¶ä¸­xä¸ºself-regulationå¾—åˆ†

-   è‡ªå˜é‡ä¸ºè¿ç»­å˜é‡ï¼Œé¢„æµ‹é¡¹ä¹Ÿæ˜¯ä¸€ä¸ªè¿ç»­å˜é‡ï¼Œ

-   éœ€è¦è¿æ¥å‡½æ•°å°†é¢„æµ‹é¡¹ä¸å› å˜é‡ï¼ˆäºŒåˆ†å˜é‡ï¼‰è¿›è¡Œè¿æ¥ã€‚

## 

![](images/1698464486990.png)

## 

-   é¢„æµ‹é¡¹å¯è¡¨ç¤ºä¸ºï¼š $z = \beta_0 + \beta_1 x$, å…¶ä¸­xä¸ºself-regulationå¾—åˆ†

-   å¦‚ä½•å°†zä¸äºŒåˆ†å˜é‡è¿›è¡Œè¿æ¥ï¼Ÿ

ï¼ˆ1ï¼‰å¯å°†é¢„æµ‹é¡¹æ˜ å°„åˆ°(0,1)ä¹‹é—´ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ $\frac{1}{1+exp(-z)}$

## 

![](images/1698464648563.png)

## 

-   é¢„æµ‹é¡¹å¯è¡¨ç¤ºä¸ºï¼š $z= \beta_0 + \beta_1 x$, å…¶ä¸­$x$ä¸ºself-regulationå¾—åˆ†

-   å¦‚ä½•å°†zä¸äºŒåˆ†å˜é‡è¿›è¡Œè¿æ¥ï¼Ÿ

    -   ï¼ˆ1ï¼‰å¯å°†é¢„æµ‹é¡¹æ˜ å°„åˆ°(0,1)ä¹‹é—´ï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨ $\frac{1}{1+exp(-z)}$

    -   ï¼ˆ2ï¼‰æ‰¾åˆ°ä¸€ä¸ªåˆ†å¸ƒï¼Œèƒ½æ ¹æ®(0,1)ä¹‹é—´çš„å€¼è½¬æˆäºŒåˆ†å˜é‡ï¼Œä¾‹å¦‚ï¼Œä¼¯åŠªåˆ©åˆ†å¸ƒã€‚

## 

![](images/1698464773553.png)

## Logit å›å½’

![](images/1698464836378.png) 

## å‚æ•°æ±‚è§£

-   å¯¹äºlogitå›å½’ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æå¤§ä¼¼ç„¶ä¼°è®¡å¯¹å…¶è¿›è¡Œæ±‚è§£

-   è¯¥æ±‚è§£è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œä¸€èˆ¬ç”±è®¡ç®—æœºè‡ªåŠ¨å®Œæˆ

![](images/1698464921155.png)

## Possion å›å½’

![](images/1698464968289.png)

## åœ¨Rä¸­çš„æ“ä½œ

:::{style="font-size:26px"}
-   ä»¥é…—é…’è¡Œä¸ºä¸ºå› å˜é‡ï¼ˆAlcohol:æœ‰é…—é…’è¡Œä¸º=1ï¼Œæ— é…—é…’è¡Œä¸º=0ï¼‰ï¼Œè¿ç»­å˜é‡è‡ªæˆ‘è°ƒèŠ‚ï¼ˆself regulationï¼‰ä¸ºè‡ªå˜é‡ã€‚

-   Model: $Alcohol = \beta_0 + \beta_1 self regulation+ ğœ€$

:::

```{r echo=TRUE}
#å»é™¤ç¼ºå¤±å€¼
df_no_missing <- na.omit(df)

#è¿›è¡Œlogitå›å½’
model_7 = glm(Alcohol ~ self_regulation, family = binomial(link='logit'), data = df_no_missing)

summary(model_7)
```

##

æ¨¡å‹æ•´ä½“æ£€éªŒ
```{r echo=TRUE}
summary(model_7)
```

$H_0: Alcohol = \beta_0$ </br>
$H_1: Alcohol = \beta_0 + \beta_1 self \ regulation$

## 

åå›å½’ç³»æ•°çš„æ˜¾è‘—æ€§æ£€éªŒ

```{r echo=TRUE}
summary(model_7)$coef
```

$$Alcohol = 1.249âˆ’0.013self regulation$$

## å›å½’æ–¹ç¨‹çš„é¢„æµ‹æƒ…å†µ

```{r echo=TRUE}
#| code-fold: true    #æŠ˜å ä»£ç 
#| code-summary: "æ¨¡å‹é¢„æµ‹æƒ…å†µ"    #ä»£ç å—è¯´æ˜æ–‡å­—
#| fig-align: "center"
# ä½¿ç”¨å·²æ‹Ÿåˆçš„é€»è¾‘å›å½’æ¨¡å‹ model_7 è¿›è¡Œé¢„æµ‹
predicted_probability <- predict(model_7, df_no_missing, type = "response", na.rm = TRUE)


# å°†æ¦‚ç‡è½¬åŒ–ä¸ºäºŒå…ƒåˆ†ç±»ï¼ˆé…—é…’/ä¸é…—é…’ï¼‰
threshold <- 0.5
binary_predictions <- ifelse(predicted_probability > threshold, 1, 0)

# åˆ›å»ºæ··æ·†çŸ©é˜µ
confusion_matrix <- table(Actual = df_no_missing$Alcohol, Predicted = binary_predictions)

# è®¡ç®—æ¨¡å‹æ€§èƒ½æŒ‡æ ‡
tp <- confusion_matrix[2, 2]  # çœŸæ­£ä¾‹ (True Positives)
tn <- confusion_matrix[1, 1]  # çœŸè´Ÿä¾‹ (True Negatives)
fp <- confusion_matrix[1, 2]  # å‡æ­£ä¾‹ (False Positives)
fn <- confusion_matrix[2, 1]  # å‡è´Ÿä¾‹ (False Negatives)

# è®¡ç®—å‡†ç¡®ç‡ (Accuracy)
accuracy <- (tp + tn) / sum(confusion_matrix)

# è®¡ç®—æ•æ„Ÿåº¦ï¼ˆsensitivityï¼‰ï¼šçœŸå®é…—é…’äººç¾¤ä¸­è¢«é¢„æµ‹ä¸ºé…—é…’è¡Œä¸ºäººç¾¤çš„æ¯”ä¾‹ï¼ŒéªŒå‡ºçœŸé˜³æ€§çš„èƒ½åŠ›
sensitivity<-tp/(tp+fn)

# è®¡ç®—ç‰¹å¼‚åº¦ï¼ˆspecificityï¼‰ï¼šä¸é…—é…’äººç¾¤ä¸­è¢«é¢„æµ‹æ— é…—é…’è¡Œä¸ºäººç¾¤çš„æ¯”ä¾‹ï¼Œæ’é™¤å‡é˜´æ€§çš„èƒ½åŠ›
specificity<-tn/(tn+fp)
```

```{r}
# è¾“å‡ºæ··æ·†çŸ©é˜µå’Œæ€§èƒ½æŒ‡æ ‡
print(confusion_matrix)
cat("Accuracy:", accuracy, "\n")
cat("sensitivity:", sensitivity, "\n")
cat("specificity:", specificity, "\n")
```

## é¢„æµ‹æƒ…å†µå¯è§†åŒ–

```{r echo=TRUE}
#| code-fold: true    
#| code-summary: "Squared_Pearson_Residuals plot"    
#| fig-align: "center"

# è®¡ç®— Squared Pearson residuals
observed_values <- df_no_missing$Alcohol
squared_pearson_residuals <- ((observed_values - predicted_probability)^2 / (predicted_probability * (1 - predicted_probability)))

# åˆ›å»ºä¸€ä¸ªæ•°æ®æ¡†åŒ…å«é¢„æµ‹å€¼å’Œæ®‹å·®
scatter_data <- data.frame(Predicted_Probability = predicted_probability, Squared_Pearson_Residuals = squared_pearson_residuals)

# ç”»å‡ºSquared_Pearson_Residuals plot
ggplot(scatter_data, aes(x = Predicted_Probability, y = Squared_Pearson_Residuals)) +
  geom_point() +
  geom_hline(yintercept = 1, linetype = "dashed", color = "grey")+
  labs(x = "Predicted_Probability", y = "Squared_Pearson_Residuals") +
  scale_x_continuous(limits = c(0, 1)) +
  scale_y_continuous(limits = c(0, 2.5)) +
  theme_apa()

```

## é¢„æµ‹æƒ…å†µå¯è§†åŒ–

```{r echo=TRUE}
#| code-fold: true    
#| code-summary: "estimates plot"    
#| fig-align: "center"
 
ggplot(df, aes(x = self_regulation, y = Alcohol)) +
  geom_point(color = "gray",na.rm = TRUE)+
  geom_smooth(method = "glm", method.args = list(family = binomial(link = "logit")), se = TRUE,na.rm = TRUE,color = "black") +  
  labs(x = "self_regulation", y = "Alcohol") +  
  scale_x_continuous(limits = c(40, 160)) + 
  scale_y_continuous(limits = c(0, 1)) +  
  theme_apa()  

```

# æ€»ç»“

-   ç¦»æ•£å‹è‡ªå˜é‡çš„çº¿æ€§å›å½’
    -   è™šæ‹Ÿå˜é‡
    -   è®¾è®¡çŸ©é˜µ
    -   å›å½’ç³»æ•°
    -   å…¶ä»–ç¼–ç æ–¹å¼
-   ç¦»æ•£å‹å› å˜é‡çš„çº¿æ€§å›å½’
    -   å¹¿ä¹‰çº¿æ€§æ¨¡å‹
    -   Logitå›å½’/logisticå›å½’
    -   Poissonå›å½’
